window.flakes = new Array(
    "<%= asset_path('weather/flakes/flake1.gif')%>",
    "<%= asset_path('weather/flakes/flake2.gif')%>",
    "<%= asset_path('weather/flakes/flake3.gif')%>",
    "<%= asset_path('weather/flakes/flake4.gif')%>",
    "<%= asset_path('weather/flakes/flake5.gif')%>"
)
window.show_initiated = false

window.amp = new Array();
window.x_pos = new Array();
window.y_pos = new Array();
window.stx = new Array();
window.sty = new Array();
window.deltax = new Array();
window.obj = new Array();

window.flake = ->
  for i in [0...obj.length]
    y_pos[i] += sty[i]
    if y_pos[i] > uheight - 49
      x_pos[i] = Math.random() * (uwidth - (amp[i]) - 29)
      y_pos[i] = 0
    deltax[i] += stx[i]
    obj[i].style.top = y_pos[i] + 'px'
    obj[i].style.left = x_pos[i] + amp[i] * Math.sin(deltax[i]) + 'px'

  setTimeout 'flake()', 50


window.init_snow = (amount = Math.round(uheight / 30)) ->
  for i in [0...amount]
    amp[i] = Math.random() * 19
    x_pos[i] = Math.random() * (uwidth - (amp[i]) - 29)
    y_pos[i] = Math.random() * uheight
    stx[i] = 0.03 + Math.random() * 0.25
    sty[i] = 2 + Math.random()
    deltax[i] = 0
    if ie4 or ns6
      new_flake = document.createElement('img')
      new_flake.setAttribute('id', "sn#{i}")
      new_flake.setAttribute('style', "position:absolute; z-index: -1; visibility:visible; top:-50px; left:-50px;")
      new_flake.setAttribute('src', flakes[Math.floor(Math.random() * flakes.length)])
      document.body.appendChild(new_flake);
      obj[i] = new_flake

window.snowfall = (amount) ->
  init_snow(amount)
  flake()

$ ->
  window.ie4 = if (document.all) then 1 else 0
  window.ns6 = if (document.getElementById && !document.all) then 1 else 0
  window.uheight = if (document.layers) then window.innerHeight else window.document.body.scrollHeight

  if (window.uheight < window.document.body.clientHeight)
    window.uheight = window.document.body.clientHeight

  window.uwidth = if (document.layers) then window.innerWidth else window.document.body.clientWidth;
